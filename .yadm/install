#!/usr/bin/env bash

# Install everything

mac_install() {
  for file in $HOME/.yadm/bin/mac/*; do
    ln -s ${file} $HOME/bin/${file##*/}
  done

  # Homebrew
  /usr/bin/ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)"

  brew bundle --file "$HOME/.yadm/Brewfile"
  # Rest is done when bootstrapped
}

linux_install() {
  for file in $HOME/.yadm/bin/linux/*; do
    cp ${file} $HOME/bin/${file##*/}
    ln -s $HOME/bin/${file##*/} ${file}
  done
}

# Create a bin folder for user scripts
if [ ! -d "$HOME/bin" ]; then
  mkdir $HOME/bin
fi

for file in $HOME/.yadm/bin/all/*; do
  ln -s ${file} $HOME/bin/${file##*/}
done

# System Check
if [ "$OSTYPE" = linux-gnu ]; then
  linux_setup
else
  mac_setup
fi

# Clone the dotfiles
yadm clone https://github.com/lewismorgan/dotfiles.git
# Change the shell to ZSH --- Keep this as the last line otherwise nothing will run after.
chsh -s $(grep /zsh$ /etc/shells | tail -1)