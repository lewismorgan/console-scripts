#!/bin/bash

# TODO: Manual Install for oh-my-zsh so it doesn't stop the bootstrap
# TODO: Fix program arguments for launchd files
# TODO: bazel requires java 1.8, install 1.8 cask right after regular java in brew file
# TODO: curl https://raw.githubusercontent.com/mbadolato/iTerm2-Color-Schemes/master/schemes/SpaceGray.itermcolorstheme for iterm color import
# TODO: defaults write com.apple.finder AppleShowAllFiles YES
# TODO: mkdir $HOME/bin
# TODO: sudo ln -s /System/Library/PrivateFrameworks/Apple80211.framework/Versions/Current/Resources/airport $HOME/bin/airport

# Bootstrap for 'Yet Another Dotfiles Manager' to setup my environment.
# Created by Lewis Morgan

# Ragequit if iTerm isn't installed because it really should be installed.
if [ $TERM_PROGRAM != "iTerm.app" ]; then
  echo "For the best experience, iTerm must be installed. Run 'yadm bootstrap' after installing iTerm."
  exit -1
fi

# install homebrew if it's missing
if ! command -v brew >/dev/null 2>&1; then
  echo "Installing homebrew üç∫"
  /usr/bin/ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)"
fi

# Now use the brewfile if it exists (which it should!)
if [ -f "$HOME/.Brewfile" ]; then
  echo "Updating homebrew bundle üçª"
  brew bundle --global
fi

# Install oh-my-zsh and powerlevel9k
if [ ! -d "$HOME/.oh-my-zsh" ]; then
  echo "Installing oh-my-zsh üíª"
  sh -c "$(curl -fsSL https://raw.githubusercontent.com/robbyrussell/oh-my-zsh/master/tools/install.sh)"
fi

if [ ! -d "$HOME/.oh-my-zsh/custom/themes/powerlevel9k" ]; then
  echo "Setting up PowerLevel9K ‚è´ for oh-my-zsh"
  git clone https://github.com/bhilburn/powerlevel9k.git ~/.oh-my-zsh/custom/themes/powerlevel9k
fi

# Create symlinks for vscode settings if installed
if [ -d "$HOME/Library/Application\ Support/Code" ]; then
  echo "Symlinking vscode settings ‚öôÔ∏è"
  ln -s $HOME/.vscode/settings/settings.json $HOME/Library/Application\ Support/Code/User/settings.json
  # Only have a settings file right now, no custom keybinds or snippets as of yet.
  #ln -s $HOME/.VSCode/keybindings.json /Users/pawelgrzybek/Library/Application\ Support/Code/User/keybindings.json
  #ln -s $HOME/.VSCode/snippets/ /Users/pawelgrzybek/Library/Application\ Support/Code/User/snippets
fi

# Set up the launchd jobs
if [ -d "$HOME/.launchd" ]; then
  echo "Symlinking launch agent definitions üìÅ"
  if [ ! -d "$HOME/Library/LaunchAgents" ]; then
    mkdir $HOME/Library/LaunchAgents
  fi

  ln -s $HOME/.launchd/com.lewisjmorgan.daily.plist $HOME/Library/LaunchAgents
  ln -s $HOME/.launchd/com.lewisjmorgan.weekly.plist $HOME/Library/LaunchAgents
  
  echo "Hooking launch agents up to launchctl üöÄ"
  launchctl load $HOME/Library/LaunchAgents/com.lewisjmorgan.daily.plist
  launchctl load $HOME/Library/LaunchAgents/com.lewisjmorgan.weekly.plist
fi
